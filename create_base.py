#!/usr/bin/env python
from ecdsa import SigningKey
from blockchain import Block
from blockchain import Wallet
from blockchain import BlockChain
from json import dumps
from hashlib import sha256

base_key = SigningKey.from_pem(open("base_pkey.pem").read())

base_wallet = Wallet(base_key)

inpt = {
    "problem": {
        "op": "constant",
        "value": 6.28318530717958647692528676655900576839433879875021164194988918461563281257241799725606965068423413596429617302656461329418768921910116446345071881625696223490056820540387704221111928924589790986076392885762195133186689225695129646757356633054240381829129713384692069722090865329642678721452049828254744917401321263117634976304184192565850818343072873578518072002266106109764093304276829390388302321886611454073151918390618437223476386522358621023709614892475992549913470377150544978245587636602389825966734672488131328617204278989279044947438140435972188740554107843435258635350476934963693533881026400113625429052712165557154268551557921834727435744293688180244990686029309917074210158455937851784708403991222425804392172806883631962725954954261992103741442269999999674595609990211946346563219263719004891891069381660528504461650668937007052386237634202000627567750577317506641676284123435533829460719650698085751093746231912572776470757518750391556371556106434245361322600385575322239181843284039787619051440213097172655773187230676365593646060390407060370593799154724519882778249944355056695826303114971448490830139190165906623372345571177815019676350927492987863851012080185540334227801969764802571672320712741532020942036388591119239789353567489
    },
    "initial_value": 42,
    "public_keys": [base_wallet.verifying_key.to_string().encode('hex')],
    "sources": [],
    "to_miner": 500000,
    "to_self": 500000
}

pubkeyhash = sha256(base_wallet.verifying_key.to_string().encode('hex')).hexdigest()

base_block = Block("base", dumps(inpt), base_wallet.sign_input_and_type(inpt, "base"), public_key_hash=pubkeyhash)

block_chain = {}
print(base_block.string_number())
block_chain[base_block.string_number()] = base_block

open("base_blockchain.json", "w").write(BlockChain(block_chain).serialize())